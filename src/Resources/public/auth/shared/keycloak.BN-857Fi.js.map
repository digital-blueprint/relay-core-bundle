{"version":3,"file":"keycloak.BN-857Fi.js","names":["#createLogger","#logWarn","#config","#callbackStorage","#adapter","#loadAdapter","#useNonce","#loginIframe","#loadConfig","#check3pCookiesSupported","#processInit","#loadDefaultAdapter","#loadCordovaAdapter","#loadCordovaNativeAdapter","#parseCallback","#processCallback","#setupEndpoints","#loadOidcConfig","#getRealmUrl","#setupOidcEndpoints","#setupCheckLoginIframe","#checkLoginIframe","#checkSsoSilently","#setToken","#scheduleCheckIframe","#parseCallbackUrl","#parseCallbackParams","#logInfo","error","#refreshQueue","#clearInvalidValues","#clearAllValues","#getStoredEntries","#parseExpiry","#getCookie","#setCookie","#cookieExpiration"],"sources":["../../../auth/node_modules/keycloak-js/lib/keycloak.js"],"sourcesContent":["// @ts-check\n/**\n * @import {Acr, KeycloakAccountOptions, KeycloakAdapter, KeycloakConfig, KeycloakError, KeycloakFlow, KeycloakInitOptions, KeycloakLoginOptions, KeycloakLogoutOptions, KeycloakPkceMethod, KeycloakProfile, KeycloakRegisterOptions, KeycloakResourceAccess, KeycloakResponseMode, KeycloakResponseType, KeycloakRoles, KeycloakTokenParsed, OpenIdProviderMetadata} from \"./keycloak.ts\"\n */\n/*\n * Copyright 2016 Red Hat, Inc. and/or its affiliates\n * and other contributors as indicated by the @author tags.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\nconst CONTENT_TYPE_JSON = 'application/json'\n\n/**\n * @typedef {Object} Endpoints\n * @property {() => string} authorize\n * @property {() => string} token\n * @property {() => string} logout\n * @property {() => string} checkSessionIframe\n * @property {() => string=} thirdPartyCookiesIframe\n * @property {() => string} register\n * @property {() => string} userinfo\n */\n\n/**\n * @typedef {Object} LoginIframe\n * @property {boolean} enable\n * @property {((error: Error | null, value?: boolean) => void)[]} callbackList\n * @property {number} interval\n * @property {HTMLIFrameElement=} iframe\n * @property {string=} iframeOrigin\n */\n\nexport default class Keycloak {\n  /** @type {Pick<PromiseWithResolvers<boolean>, 'resolve' | 'reject'>[]} */\n  #refreshQueue = []\n  /** @type {KeycloakAdapter} */\n  #adapter\n  /** @type {boolean} */\n  #useNonce = true\n  /** @type {CallbackStorage} */\n  #callbackStorage\n  #logInfo = this.#createLogger(console.info)\n  #logWarn = this.#createLogger(console.warn)\n  /** @type {LoginIframe} */\n  #loginIframe = {\n    enable: true,\n    callbackList: [],\n    interval: 5\n  }\n\n  /** @type {KeycloakConfig} config */\n  #config\n  didInitialize = false\n  authenticated = false\n  loginRequired = false\n  /** @type {KeycloakResponseMode} */\n  responseMode = 'fragment'\n  /** @type {KeycloakResponseType} */\n  responseType = 'code'\n  /** @type {KeycloakFlow} */\n  flow = 'standard'\n  /** @type {number?} */\n  timeSkew = null\n  /** @type {string=} */\n  redirectUri\n  /** @type {string=} */\n  silentCheckSsoRedirectUri\n  /** @type {boolean} */\n  silentCheckSsoFallback = true\n  /** @type {KeycloakPkceMethod} */\n  pkceMethod = 'S256'\n  enableLogging = false\n  /** @type {'GET' | 'POST'} */\n  logoutMethod = 'GET'\n  /** @type {string=} */\n  scope\n  messageReceiveTimeout = 10000\n  /** @type {string=} */\n  idToken\n  /** @type {KeycloakTokenParsed=} */\n  idTokenParsed\n  /** @type {string=} */\n  token\n  /** @type {KeycloakTokenParsed=} */\n  tokenParsed\n  /** @type {string=} */\n  refreshToken\n  /** @type {KeycloakTokenParsed=} */\n  refreshTokenParsed\n  /** @type {string=} */\n  clientId\n  /** @type {string=} */\n  sessionId\n  /** @type {string=} */\n  subject\n  /** @type {string=} */\n  authServerUrl\n  /** @type {string=} */\n  realm\n  /** @type {KeycloakRoles=} */\n  realmAccess\n  /** @type {KeycloakResourceAccess=} */\n  resourceAccess\n  /** @type {KeycloakProfile=} */\n  profile\n  /** @type {{}=} */\n  userInfo\n  /** @type {Endpoints} */\n  endpoints\n  /** @type {number=} */\n  tokenTimeoutHandle\n  /** @type {() => void=} */\n  onAuthSuccess\n  /** @type {(errorData?: KeycloakError) => void=} */\n  onAuthError\n  /** @type {() => void=} */\n  onAuthRefreshSuccess\n  /** @type {() => void=} */\n  onAuthRefreshError\n  /** @type {() => void=} */\n  onTokenExpired\n  /** @type {() => void=} */\n  onAuthLogout\n  /** @type {(authenticated: boolean) => void=} */\n  onReady\n  /** @type {(status: 'success' | 'cancelled' | 'error', action: string) => void=} */\n  onActionUpdate\n\n  /**\n   * @param {KeycloakConfig} config\n   */\n  constructor (config) {\n    if (typeof config !== 'string' && !isObject(config)) {\n      throw new Error(\"The 'Keycloak' constructor must be provided with a configuration object, or a URL to a JSON configuration file.\")\n    }\n\n    if (isObject(config)) {\n      const requiredProperties = 'oidcProvider' in config\n        ? ['clientId']\n        : ['url', 'realm', 'clientId']\n\n      for (const property of requiredProperties) {\n        if (!(property in config)) {\n          throw new Error(`The configuration object is missing the required '${property}' property.`)\n        }\n      }\n    }\n\n    if (!globalThis.isSecureContext) {\n      this.#logWarn(\n        \"[KEYCLOAK] Keycloak JS must be used in a 'secure context' to function properly as it relies on browser APIs that are otherwise not available.\\n\" +\n                'Continuing to run your application insecurely will lead to unexpected behavior and breakage.\\n\\n' +\n                'For more information see: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts'\n      )\n    }\n\n    this.#config = config\n  }\n\n  /**\n   * @param {KeycloakInitOptions} initOptions\n   * @returns {Promise<boolean>}\n   */\n  init = async (initOptions = {}) => {\n    if (this.didInitialize) {\n      throw new Error(\"A 'Keycloak' instance can only be initialized once.\")\n    }\n\n    this.didInitialize = true\n    this.#callbackStorage = createCallbackStorage()\n\n    const adapters = ['default', 'cordova', 'cordova-native']\n\n    if (typeof initOptions.adapter === 'string' && adapters.includes(initOptions.adapter)) {\n      this.#adapter = this.#loadAdapter(initOptions.adapter)\n    } else if (typeof initOptions.adapter === 'object') {\n      this.#adapter = initOptions.adapter\n    } else if ('Cordova' in window || 'cordova' in window) {\n      this.#adapter = this.#loadAdapter('cordova')\n    } else {\n      this.#adapter = this.#loadAdapter('default')\n    }\n\n    if (typeof initOptions.useNonce !== 'undefined') {\n      this.#useNonce = initOptions.useNonce\n    }\n\n    if (typeof initOptions.checkLoginIframe !== 'undefined') {\n      this.#loginIframe.enable = initOptions.checkLoginIframe\n    }\n\n    if (initOptions.checkLoginIframeInterval) {\n      this.#loginIframe.interval = initOptions.checkLoginIframeInterval\n    }\n\n    if (initOptions.onLoad === 'login-required') {\n      this.loginRequired = true\n    }\n\n    if (initOptions.responseMode) {\n      if (initOptions.responseMode === 'query' || initOptions.responseMode === 'fragment') {\n        this.responseMode = initOptions.responseMode\n      } else {\n        throw new Error('Invalid value for responseMode')\n      }\n    }\n\n    if (initOptions.flow) {\n      switch (initOptions.flow) {\n        case 'standard':\n          this.responseType = 'code'\n          break\n        case 'implicit':\n          this.responseType = 'id_token token'\n          break\n        case 'hybrid':\n          this.responseType = 'code id_token token'\n          break\n        default:\n          throw new Error('Invalid value for flow')\n      }\n      this.flow = initOptions.flow\n    }\n\n    if (typeof initOptions.timeSkew === 'number') {\n      this.timeSkew = initOptions.timeSkew\n    }\n\n    if (initOptions.redirectUri) {\n      this.redirectUri = initOptions.redirectUri\n    }\n\n    if (initOptions.silentCheckSsoRedirectUri) {\n      this.silentCheckSsoRedirectUri = initOptions.silentCheckSsoRedirectUri\n    }\n\n    if (typeof initOptions.silentCheckSsoFallback === 'boolean') {\n      this.silentCheckSsoFallback = initOptions.silentCheckSsoFallback\n    }\n\n    if (typeof initOptions.pkceMethod !== 'undefined') {\n      if (initOptions.pkceMethod !== 'S256' && initOptions.pkceMethod !== false) {\n        throw new TypeError(`Invalid value for pkceMethod', expected 'S256' or false but got ${initOptions.pkceMethod}.`)\n      }\n\n      this.pkceMethod = initOptions.pkceMethod\n    }\n\n    if (typeof initOptions.enableLogging === 'boolean') {\n      this.enableLogging = initOptions.enableLogging\n    }\n\n    if (initOptions.logoutMethod === 'POST') {\n      this.logoutMethod = 'POST'\n    }\n\n    if (typeof initOptions.scope === 'string') {\n      this.scope = initOptions.scope\n    }\n\n    if (typeof initOptions.messageReceiveTimeout === 'number' && initOptions.messageReceiveTimeout > 0) {\n      this.messageReceiveTimeout = initOptions.messageReceiveTimeout\n    }\n\n    await this.#loadConfig()\n    await this.#check3pCookiesSupported()\n    await this.#processInit(initOptions)\n\n    this.onReady?.(this.authenticated)\n\n    return this.authenticated\n  }\n\n  /**\n   * @param {\"default\" | \"cordova\" | \"cordova-native\"} type\n   * @returns {KeycloakAdapter}\n   */\n  #loadAdapter (type) {\n    if (type === 'default') {\n      return this.#loadDefaultAdapter()\n    }\n\n    if (type === 'cordova') {\n      this.#loginIframe.enable = false\n      return this.#loadCordovaAdapter()\n    }\n\n    if (type === 'cordova-native') {\n      this.#loginIframe.enable = false\n      return this.#loadCordovaNativeAdapter()\n    }\n\n    throw new Error('invalid adapter type: ' + type)\n  }\n\n  /**\n   * @returns {KeycloakAdapter}\n   */\n  #loadDefaultAdapter () {\n    /** @type {KeycloakAdapter['redirectUri']}{} */\n    const redirectUri = (options) => {\n      return options?.redirectUri || this.redirectUri || globalThis.location.href\n    }\n\n    return {\n      login: async (options) => {\n        window.location.assign(await this.createLoginUrl(options))\n        return await new Promise(() => {})\n      },\n\n      logout: async (options) => {\n        const logoutMethod = options?.logoutMethod ?? this.logoutMethod\n\n        if (logoutMethod === 'GET') {\n          window.location.replace(this.createLogoutUrl(options))\n          return\n        }\n\n        // Create form to send POST request.\n        const form = document.createElement('form')\n\n        form.setAttribute('method', 'POST')\n        form.setAttribute('action', this.createLogoutUrl(options))\n        form.style.display = 'none'\n\n        // Add data to form as hidden input fields.\n        const data = {\n          id_token_hint: this.idToken,\n          client_id: this.clientId,\n          post_logout_redirect_uri: redirectUri(options)\n        }\n\n        for (const [name, value] of Object.entries(data)) {\n          const input = document.createElement('input')\n\n          input.setAttribute('type', 'hidden')\n          input.setAttribute('name', name)\n          input.setAttribute('value', /** @type {string} */ (value))\n\n          form.appendChild(input)\n        }\n\n        // Append form to page and submit it to perform logout and redirect.\n        document.body.appendChild(form)\n        form.submit()\n      },\n\n      register: async (options) => {\n        window.location.assign(await this.createRegisterUrl(options))\n        return await new Promise(() => {})\n      },\n\n      accountManagement: async () => {\n        const accountUrl = this.createAccountUrl()\n        if (typeof accountUrl !== 'undefined') {\n          window.location.href = accountUrl\n        } else {\n          throw new Error('Not supported by the OIDC server')\n        }\n        return await new Promise(() => {})\n      },\n\n      redirectUri\n    }\n  }\n\n  /**\n   * @returns {KeycloakAdapter}\n   */\n  #loadCordovaAdapter () {\n    /**\n     * @param {string} loginUrl\n     * @param {string} target\n     * @param {string} options\n     * @returns {WindowProxy | null}\n     */\n    const cordovaOpenWindowWrapper = (loginUrl, target, options) => {\n      if (window.cordova && window.cordova.InAppBrowser) {\n        // Use inappbrowser for IOS and Android if available\n        return window.cordova.InAppBrowser.open(loginUrl, target, options)\n      } else {\n        return window.open(loginUrl, target, options)\n      }\n    }\n\n    const shallowCloneCordovaOptions = (userOptions) => {\n      if (userOptions && userOptions.cordovaOptions) {\n        return Object.keys(userOptions.cordovaOptions).reduce((options, optionName) => {\n          options[optionName] = userOptions.cordovaOptions[optionName]\n          return options\n        }, {})\n      } else {\n        return {}\n      }\n    }\n\n    const formatCordovaOptions = (cordovaOptions) => {\n      return Object.keys(cordovaOptions).reduce((options, optionName) => {\n        options.push(optionName + '=' + cordovaOptions[optionName])\n        return options\n      }, []).join(',')\n    }\n\n    const createCordovaOptions = (userOptions) => {\n      const cordovaOptions = shallowCloneCordovaOptions(userOptions)\n      cordovaOptions.location = 'no'\n      if (userOptions && userOptions.prompt === 'none') {\n        cordovaOptions.hidden = 'yes'\n      }\n      return formatCordovaOptions(cordovaOptions)\n    }\n\n    const getCordovaRedirectUri = () => {\n      return this.redirectUri || 'http://localhost'\n    }\n\n    return {\n      login: async (options) => {\n        const cordovaOptions = createCordovaOptions(options)\n        const loginUrl = await this.createLoginUrl(options)\n        const ref = cordovaOpenWindowWrapper(loginUrl, '_blank', cordovaOptions)\n        let completed = false\n        let closed = false\n\n        function closeBrowser () {\n          closed = true\n          ref.close()\n        };\n\n        return await new Promise((resolve, reject) => {\n          ref.addEventListener('loadstart', async (event) => {\n            if (event.url.indexOf(getCordovaRedirectUri()) === 0) {\n              const callback = this.#parseCallback(event.url)\n\n              try {\n                await this.#processCallback(callback)\n                resolve()\n              } catch (error) {\n                reject(error)\n              }\n              closeBrowser()\n              completed = true\n            }\n          })\n\n          ref.addEventListener('loaderror', async (event) => {\n            if (!completed) {\n              if (event.url.indexOf(getCordovaRedirectUri()) === 0) {\n                const callback = this.#parseCallback(event.url)\n                try {\n                  await this.#processCallback(callback)\n                  resolve()\n                } catch (error) {\n                  reject(error)\n                }\n                closeBrowser()\n                completed = true\n              } else {\n                reject(new Error('Unable to process login.'))\n                closeBrowser()\n              }\n            }\n          })\n\n          ref.addEventListener('exit', function (event) {\n            if (!closed) {\n              reject(new Error('User closed the login window.'))\n            }\n          })\n        })\n      },\n\n      logout: async (options) => {\n        const logoutUrl = this.createLogoutUrl(options)\n        const ref = cordovaOpenWindowWrapper(logoutUrl, '_blank', 'location=no,hidden=yes,clearcache=yes')\n        let error = false\n\n        ref.addEventListener('loadstart', (event) => {\n          if (event.url.indexOf(getCordovaRedirectUri()) === 0) {\n            ref.close()\n          }\n        })\n\n        ref.addEventListener('loaderror', (event) => {\n          if (event.url.indexOf(getCordovaRedirectUri()) === 0) {\n            ref.close()\n          } else {\n            error = true\n            ref.close()\n          }\n        })\n\n        await new Promise((resolve, reject) => {\n          ref.addEventListener('exit', () => {\n            if (error) {\n              reject(new Error('User closed the login window.'))\n            } else {\n              this.clearToken()\n              resolve()\n            }\n          })\n        })\n      },\n\n      register: async (options) => {\n        const registerUrl = await this.createRegisterUrl()\n        const cordovaOptions = createCordovaOptions(options)\n        const ref = cordovaOpenWindowWrapper(registerUrl, '_blank', cordovaOptions)\n\n        /** @type {Promise<void>} */\n        const promise = new Promise((resolve, reject) => {\n          ref.addEventListener('loadstart', async (event) => {\n            if (event.url.indexOf(getCordovaRedirectUri()) === 0) {\n              ref.close()\n              const oauth = this.#parseCallback(event.url)\n\n              try {\n                await this.#processCallback(oauth)\n                resolve()\n              } catch (error) {\n                reject(error)\n              }\n            }\n          })\n        })\n\n        await promise\n      },\n\n      accountManagement: async () => {\n        const accountUrl = this.createAccountUrl()\n        if (typeof accountUrl !== 'undefined') {\n          const ref = cordovaOpenWindowWrapper(accountUrl, '_blank', 'location=no')\n          ref.addEventListener('loadstart', function (event) {\n            if (event.url.indexOf(getCordovaRedirectUri()) === 0) {\n              ref.close()\n            }\n          })\n        } else {\n          throw new Error('Not supported by the OIDC server')\n        }\n      },\n\n      redirectUri: () => {\n        return getCordovaRedirectUri()\n      }\n    }\n  }\n\n  /**\n   * @returns {KeycloakAdapter}\n   */\n  #loadCordovaNativeAdapter () {\n    /* global universalLinks */\n    return {\n      login: async (options) => {\n        const loginUrl = await this.createLoginUrl(options)\n\n        await new Promise((resolve, reject) => {\n          universalLinks.subscribe('keycloak', async (event) => {\n            universalLinks.unsubscribe('keycloak')\n            window.cordova.plugins.browsertab.close()\n            const oauth = this.#parseCallback(event.url)\n\n            try {\n              await this.#processCallback(oauth)\n              resolve()\n            } catch (error) {\n              reject(error)\n            }\n          })\n\n          window.cordova.plugins.browsertab.openUrl(loginUrl)\n        })\n      },\n\n      logout: async (options) => {\n        const logoutUrl = this.createLogoutUrl(options)\n\n        await new Promise((resolve) => {\n          universalLinks.subscribe('keycloak', () => {\n            universalLinks.unsubscribe('keycloak')\n            window.cordova.plugins.browsertab.close()\n            this.clearToken()\n            resolve()\n          })\n\n          window.cordova.plugins.browsertab.openUrl(logoutUrl)\n        })\n      },\n\n      register: async (options) => {\n        const registerUrl = await this.createRegisterUrl(options)\n\n        await new Promise((resolve, reject) => {\n          universalLinks.subscribe('keycloak', async (event) => {\n            universalLinks.unsubscribe('keycloak')\n            window.cordova.plugins.browsertab.close()\n            const oauth = this.#parseCallback(event.url)\n            try {\n              await this.#processCallback(oauth)\n              resolve()\n            } catch (error) {\n              reject(error)\n            }\n          })\n\n          window.cordova.plugins.browsertab.openUrl(registerUrl)\n        })\n      },\n\n      accountManagement: async () => {\n        const accountUrl = this.createAccountUrl()\n        if (typeof accountUrl !== 'undefined') {\n          window.cordova.plugins.browsertab.openUrl(accountUrl)\n        } else {\n          throw new Error('Not supported by the OIDC server')\n        }\n      },\n\n      redirectUri: (options) => {\n        if (options && options.redirectUri) {\n          return options.redirectUri\n        } else if (this.redirectUri) {\n          return this.redirectUri\n        } else {\n          return 'http://localhost'\n        }\n      }\n    }\n  }\n\n  /**\n   * @returns {Promise<void>}\n   */\n  async #loadConfig () {\n    if (typeof this.#config === 'string') {\n      const jsonConfig = await fetchJsonConfig(this.#config)\n      this.authServerUrl = jsonConfig['auth-server-url']\n      this.realm = jsonConfig.realm\n      this.clientId = jsonConfig.resource\n      this.#setupEndpoints()\n    } else {\n      this.clientId = this.#config.clientId\n\n      if ('oidcProvider' in this.#config) {\n        await this.#loadOidcConfig(this.#config.oidcProvider)\n      } else {\n        this.authServerUrl = this.#config.url\n        this.realm = this.#config.realm\n        this.#setupEndpoints()\n      }\n    }\n  }\n\n  /**\n   * @returns {void}\n   */\n  #setupEndpoints () {\n    this.endpoints = {\n      authorize: () => {\n        return this.#getRealmUrl() + '/protocol/openid-connect/auth'\n      },\n      token: () => {\n        return this.#getRealmUrl() + '/protocol/openid-connect/token'\n      },\n      logout: () => {\n        return this.#getRealmUrl() + '/protocol/openid-connect/logout'\n      },\n      checkSessionIframe: () => {\n        return this.#getRealmUrl() + '/protocol/openid-connect/login-status-iframe.html'\n      },\n      thirdPartyCookiesIframe: () => {\n        return this.#getRealmUrl() + '/protocol/openid-connect/3p-cookies/step1.html'\n      },\n      register: () => {\n        return this.#getRealmUrl() + '/protocol/openid-connect/registrations'\n      },\n      userinfo: () => {\n        return this.#getRealmUrl() + '/protocol/openid-connect/userinfo'\n      }\n    }\n  }\n\n  /**\n   * @param {string | OpenIdProviderMetadata} oidcProvider\n   * @returns {Promise<void>}\n   */\n  async #loadOidcConfig (oidcProvider) {\n    if (typeof oidcProvider === 'string') {\n      const url = `${stripTrailingSlash(oidcProvider)}/.well-known/openid-configuration`\n      const openIdConfig = await fetchOpenIdConfig(url)\n      this.#setupOidcEndpoints(openIdConfig)\n    } else {\n      this.#setupOidcEndpoints(oidcProvider)\n    }\n  }\n\n  /**\n   * @param {OpenIdProviderMetadata} config\n   * @returns {void}\n   */\n  #setupOidcEndpoints (config) {\n    this.endpoints = {\n      authorize () {\n        return config.authorization_endpoint\n      },\n      token () {\n        return config.token_endpoint\n      },\n      logout () {\n        if (!config.end_session_endpoint) {\n          throw new Error('Not supported by the OIDC server')\n        }\n        return config.end_session_endpoint\n      },\n      checkSessionIframe () {\n        if (!config.check_session_iframe) {\n          throw new Error('Not supported by the OIDC server')\n        }\n        return config.check_session_iframe\n      },\n      register () {\n        throw new Error('Redirection to \"Register user\" page not supported in standard OIDC mode')\n      },\n      userinfo () {\n        if (!config.userinfo_endpoint) {\n          throw new Error('Not supported by the OIDC server')\n        }\n        return config.userinfo_endpoint\n      }\n    }\n  }\n\n  /**\n   * @returns {Promise<void>}\n   */\n  async #check3pCookiesSupported () {\n    if ((!this.#loginIframe.enable && !this.silentCheckSsoRedirectUri) || typeof this.endpoints.thirdPartyCookiesIframe !== 'function') {\n      return\n    }\n\n    const iframe = document.createElement('iframe')\n    iframe.setAttribute('src', this.endpoints.thirdPartyCookiesIframe())\n    iframe.setAttribute('sandbox', 'allow-storage-access-by-user-activation allow-scripts allow-same-origin')\n    iframe.setAttribute('title', 'keycloak-3p-check-iframe')\n    iframe.style.display = 'none'\n    document.body.appendChild(iframe)\n\n    /** @type {Promise<void>} */\n    const promise = new Promise((resolve) => {\n      /**\n       * @param {MessageEvent} event\n       */\n      const messageCallback = (event) => {\n        if (iframe.contentWindow !== event.source) {\n          return\n        }\n\n        if (event.data !== 'supported' && event.data !== 'unsupported') {\n          return\n        } else if (event.data === 'unsupported') {\n          this.#logWarn(\n            '[KEYCLOAK] Your browser is blocking access to 3rd-party cookies, this means:\\n\\n' +\n                        ' - It is not possible to retrieve tokens without redirecting to the Keycloak server (a.k.a. no support for silent authentication).\\n' +\n                        ' - It is not possible to automatically detect changes to the session status (such as the user logging out in another tab).\\n\\n' +\n                        'For more information see: https://www.keycloak.org/securing-apps/javascript-adapter#_modern_browsers'\n          )\n\n          this.#loginIframe.enable = false\n          if (this.silentCheckSsoFallback) {\n            this.silentCheckSsoRedirectUri = undefined\n          }\n        }\n\n        document.body.removeChild(iframe)\n        window.removeEventListener('message', messageCallback)\n        resolve()\n      }\n\n      window.addEventListener('message', messageCallback, false)\n    })\n\n    return await applyTimeoutToPromise(promise, this.messageReceiveTimeout, 'Timeout when waiting for 3rd party check iframe message.')\n  }\n\n  /**\n   * @param {KeycloakInitOptions} initOptions\n   * @returns {Promise<void>}\n   */\n  async #processInit (initOptions) {\n    const callback = this.#parseCallback(window.location.href)\n\n    if (callback?.newUrl) {\n      window.history.replaceState(window.history.state, '', callback.newUrl)\n    }\n\n    if (callback && callback.valid) {\n      await this.#setupCheckLoginIframe()\n      await this.#processCallback(callback)\n      return\n    }\n\n    /** @param {boolean} prompt */\n    const doLogin = async (prompt) => {\n      /** @type {KeycloakLoginOptions} */\n      const options = {}\n\n      if (!prompt) {\n        options.prompt = 'none'\n      }\n\n      if (initOptions.locale) {\n        options.locale = initOptions.locale\n      }\n\n      await this.login(options)\n    }\n\n    const onLoad = async () => {\n      switch (initOptions.onLoad) {\n        case 'check-sso':\n          if (this.#loginIframe.enable) {\n            await this.#setupCheckLoginIframe()\n            const unchanged = await this.#checkLoginIframe()\n\n            if (!unchanged) {\n              this.silentCheckSsoRedirectUri ? await this.#checkSsoSilently() : await doLogin(false)\n            }\n          } else {\n            this.silentCheckSsoRedirectUri ? await this.#checkSsoSilently() : await doLogin(false)\n          }\n          break\n        case 'login-required':\n          await doLogin(true)\n          break\n        default:\n          throw new Error('Invalid value for onLoad')\n      }\n    }\n\n    if (initOptions.token && initOptions.refreshToken) {\n      this.#setToken(initOptions.token, initOptions.refreshToken, initOptions.idToken)\n\n      if (this.#loginIframe.enable) {\n        await this.#setupCheckLoginIframe()\n        const unchanged = await this.#checkLoginIframe()\n\n        if (unchanged) {\n          this.onAuthSuccess?.()\n          this.#scheduleCheckIframe()\n        }\n      } else {\n        try {\n          await this.updateToken(-1)\n          this.onAuthSuccess?.()\n        } catch (error) {\n          this.onAuthError?.()\n          if (initOptions.onLoad) {\n            await onLoad()\n          } else {\n            throw error\n          }\n        }\n      }\n    } else if (initOptions.onLoad) {\n      await onLoad()\n    }\n  }\n\n  /**\n   * @returns {Promise<void>}\n   */\n  async #setupCheckLoginIframe () {\n    if (!this.#loginIframe.enable || this.#loginIframe.iframe) {\n      return\n    }\n\n    const iframe = document.createElement('iframe')\n    this.#loginIframe.iframe = iframe\n    iframe.setAttribute('src', this.endpoints.checkSessionIframe())\n    iframe.setAttribute('sandbox', 'allow-storage-access-by-user-activation allow-scripts allow-same-origin')\n    iframe.setAttribute('title', 'keycloak-session-iframe')\n    iframe.style.display = 'none'\n    document.body.appendChild(iframe)\n\n    /**\n     * @param {MessageEvent} event\n     */\n    const messageCallback = (event) => {\n      if (event.origin !== this.#loginIframe.iframeOrigin || this.#loginIframe.iframe?.contentWindow !== event.source) {\n        return\n      }\n\n      if (!(event.data === 'unchanged' || event.data === 'changed' || event.data === 'error')) {\n        return\n      }\n\n      if (event.data !== 'unchanged') {\n        this.clearToken()\n      }\n\n      const callbacks = this.#loginIframe.callbackList\n      this.#loginIframe.callbackList = []\n\n      for (const callback of callbacks.reverse()) {\n        if (event.data === 'error') {\n          callback(new Error('Error while checking login iframe'))\n        } else {\n          callback(null, event.data === 'unchanged')\n        }\n      }\n    }\n\n    window.addEventListener('message', messageCallback, false)\n\n    /** @type {Promise<void>} */\n    const promise = new Promise((resolve) => {\n      iframe.addEventListener('load', () => {\n        const authUrl = this.endpoints.authorize()\n        if (authUrl.startsWith('/')) {\n          this.#loginIframe.iframeOrigin = globalThis.location.origin\n        } else {\n          this.#loginIframe.iframeOrigin = new URL(authUrl).origin\n        }\n        resolve()\n      })\n    })\n\n    await promise\n  }\n\n  /**\n   * @returns {Promise<boolean | undefined>}\n   */\n  async #checkLoginIframe () {\n    if (!this.#loginIframe.iframe || !this.#loginIframe.iframeOrigin) {\n      return\n    }\n\n    const message = `${this.clientId} ${(this.sessionId ? this.sessionId : '')}`\n    const origin = this.#loginIframe.iframeOrigin\n\n    /** @type {Promise<boolean>} */\n    const promise = new Promise((resolve, reject) => {\n      /** @type {(error: Error | null, value?: boolean) => void} */\n      const callback = (error, result) => error ? reject(error) : resolve(/** @type {boolean} */ (result))\n\n      this.#loginIframe.callbackList.push(callback)\n\n      if (this.#loginIframe.callbackList.length === 1) {\n        this.#loginIframe.iframe?.contentWindow?.postMessage(message, origin)\n      }\n    })\n\n    return await promise\n  }\n\n  /**\n   * @returns {Promise<void>}\n   */\n  async #checkSsoSilently () {\n    const iframe = document.createElement('iframe')\n    const src = await this.createLoginUrl({ prompt: 'none', redirectUri: this.silentCheckSsoRedirectUri })\n    iframe.setAttribute('src', src)\n    iframe.setAttribute('sandbox', 'allow-storage-access-by-user-activation allow-scripts allow-same-origin')\n    iframe.setAttribute('title', 'keycloak-silent-check-sso')\n    iframe.style.display = 'none'\n    document.body.appendChild(iframe)\n\n    return await new Promise((resolve, reject) => {\n      /**\n       * @param {MessageEvent} event\n       */\n      const messageCallback = async (event) => {\n        if (event.origin !== window.location.origin || iframe.contentWindow !== event.source) {\n          return\n        }\n\n        const oauth = this.#parseCallback(event.data)\n\n        try {\n          await this.#processCallback(oauth)\n          resolve()\n        } catch (error) {\n          reject(error)\n        }\n\n        document.body.removeChild(iframe)\n        window.removeEventListener('message', messageCallback)\n      }\n\n      window.addEventListener('message', messageCallback)\n    })\n  };\n\n  /**\n   * @param {string} url\n   */\n  #parseCallback (url) {\n    const oauth = this.#parseCallbackUrl(url)\n    if (!oauth) {\n      return\n    }\n\n    const oauthState = this.#callbackStorage.get(oauth.state)\n\n    if (oauthState) {\n      oauth.valid = true\n      oauth.redirectUri = oauthState.redirectUri\n      oauth.storedNonce = oauthState.nonce\n      oauth.prompt = oauthState.prompt\n      oauth.pkceCodeVerifier = oauthState.pkceCodeVerifier\n      oauth.loginOptions = oauthState.loginOptions\n    }\n\n    return oauth\n  }\n\n  /**\n   * @param {string} urlString\n   */\n  #parseCallbackUrl (urlString) {\n    let supportedParams = []\n    switch (this.flow) {\n      case 'standard':\n        supportedParams = ['code', 'state', 'session_state', 'kc_action_status', 'kc_action', 'iss']\n        break\n      case 'implicit':\n        supportedParams = ['access_token', 'token_type', 'id_token', 'state', 'session_state', 'expires_in', 'kc_action_status', 'kc_action', 'iss']\n        break\n      case 'hybrid':\n        supportedParams = ['access_token', 'token_type', 'id_token', 'code', 'state', 'session_state', 'expires_in', 'kc_action_status', 'kc_action', 'iss']\n        break\n    }\n\n    supportedParams.push('error')\n    supportedParams.push('error_description')\n    supportedParams.push('error_uri')\n\n    const url = new URL(urlString)\n    let newUrl = ''\n    let parsed\n\n    if (this.responseMode === 'query' && url.searchParams.size > 0) {\n      parsed = this.#parseCallbackParams(url.search, supportedParams)\n      url.search = parsed.paramsString\n      newUrl = url.toString()\n    } else if (this.responseMode === 'fragment' && url.hash.length > 0) {\n      parsed = this.#parseCallbackParams(url.hash.substring(1), supportedParams)\n      url.hash = parsed.paramsString\n      newUrl = url.toString()\n    }\n\n    if (parsed?.oauthParams) {\n      if (this.flow === 'standard' || this.flow === 'hybrid') {\n        if ((parsed.oauthParams.code || parsed.oauthParams.error) && parsed.oauthParams.state) {\n          parsed.oauthParams.newUrl = newUrl\n          return parsed.oauthParams\n        }\n      } else if (this.flow === 'implicit') {\n        if ((parsed.oauthParams.access_token || parsed.oauthParams.error) && parsed.oauthParams.state) {\n          parsed.oauthParams.newUrl = newUrl\n          return parsed.oauthParams\n        }\n      }\n    }\n  }\n\n  /**\n   * @typedef {Object} ParsedCallbackParams\n   * @property {string} paramsString\n   * @property {Record<string, string | undefined>} oauthParams\n   */\n\n  /**\n   * @param {string} paramsString\n   * @param {string[]} supportedParams\n   * @returns {ParsedCallbackParams}\n   */\n  #parseCallbackParams (paramsString, supportedParams) {\n    const params = new URLSearchParams(paramsString)\n    /** @type {Record<string, string>} */\n    const oauthParams = {}\n\n    for (const [key, value] of Array.from(params.entries())) {\n      if (supportedParams.includes(key)) {\n        oauthParams[key] = value\n        params.delete(key)\n      }\n    }\n\n    return {\n      paramsString: params.toString(),\n      oauthParams\n    }\n  }\n\n  async #processCallback (oauth) {\n    const { code, error, prompt } = oauth\n    let timeLocal = new Date().getTime()\n\n    /**\n     * @param {string} accessToken\n     * @param {string=} refreshToken\n     * @param {string=} idToken\n     */\n    const authSuccess = (accessToken, refreshToken, idToken) => {\n      timeLocal = (timeLocal + new Date().getTime()) / 2\n\n      this.#setToken(accessToken, refreshToken, idToken, timeLocal)\n\n      if (this.#useNonce && (this.idTokenParsed && this.idTokenParsed.nonce !== oauth.storedNonce)) {\n        this.#logInfo('[KEYCLOAK] Invalid nonce, clearing token')\n        this.clearToken()\n        throw new Error('Invalid nonce.')\n      }\n    }\n\n    if (oauth.kc_action_status) {\n      this.onActionUpdate && this.onActionUpdate(oauth.kc_action_status, oauth.kc_action)\n    }\n\n    if (error) {\n      if (prompt !== 'none') {\n        if (oauth.error_description && oauth.error_description === 'authentication_expired') {\n          await this.login(oauth.loginOptions)\n        } else {\n          const errorData = { error, error_description: oauth.error_description }\n          this.onAuthError?.(errorData)\n          throw errorData\n        }\n      }\n      return\n    } else if ((this.flow !== 'standard') && (oauth.access_token || oauth.id_token)) {\n      authSuccess(oauth.access_token, undefined, oauth.id_token)\n      this.onAuthSuccess?.()\n    }\n\n    if ((this.flow !== 'implicit') && code) {\n      try {\n        const response = await fetchAccessToken(this.endpoints.token(), code, /** @type {string} */ (this.clientId), oauth.redirectUri, oauth.pkceCodeVerifier)\n        authSuccess(response.access_token, response.refresh_token, response.id_token)\n\n        if (this.flow === 'standard') {\n          this.onAuthSuccess?.()\n        }\n\n        this.#scheduleCheckIframe()\n      } catch (error) {\n        this.onAuthError?.()\n        throw error\n      }\n    }\n  }\n\n  async #scheduleCheckIframe () {\n    if (this.#loginIframe.enable && this.token) {\n      await waitForTimeout(this.#loginIframe.interval * 1000)\n      const unchanged = await this.#checkLoginIframe()\n\n      if (unchanged) {\n        await this.#scheduleCheckIframe()\n      }\n    }\n  }\n\n  /**\n   * @param {KeycloakLoginOptions} [options]\n   * @returns {Promise<void>}\n   */\n  login = (options) => {\n    return this.#adapter.login(options)\n  }\n\n  /**\n   * @param {KeycloakLoginOptions} [options]\n   * @returns {Promise<string>}\n   */\n  createLoginUrl = async (options) => {\n    const state = createUUID()\n    const nonce = createUUID()\n    const redirectUri = this.#adapter.redirectUri(options)\n    /** @type {CallbackState} */\n    const callbackState = {\n      state,\n      nonce,\n      redirectUri,\n      loginOptions: options\n    }\n\n    if (options?.prompt) {\n      callbackState.prompt = options.prompt\n    }\n\n    const url = options?.action === 'register'\n      ? this.endpoints.register()\n      : this.endpoints.authorize()\n\n    let scope = options?.scope || this.scope\n    const scopeValues = scope ? scope.split(' ') : []\n\n    // Ensure the 'openid' scope is always included.\n    if (!scopeValues.includes('openid')) {\n      scopeValues.unshift('openid')\n    }\n\n    scope = scopeValues.join(' ')\n\n    const params = new URLSearchParams([\n      ['client_id', /** @type {string} */ (this.clientId)],\n      ['redirect_uri', redirectUri],\n      ['state', state],\n      ['response_mode', this.responseMode],\n      ['response_type', this.responseType],\n      ['scope', scope]\n    ])\n\n    if (this.#useNonce) {\n      params.append('nonce', nonce)\n    }\n\n    if (options?.prompt) {\n      params.append('prompt', options.prompt)\n    }\n\n    if (typeof options?.maxAge === 'number') {\n      params.append('max_age', options.maxAge.toString())\n    }\n\n    if (options?.loginHint) {\n      params.append('login_hint', options.loginHint)\n    }\n\n    if (options?.idpHint) {\n      params.append('kc_idp_hint', options.idpHint)\n    }\n\n    if (options?.action && options.action !== 'register') {\n      params.append('kc_action', options.action)\n    }\n\n    if (options?.locale) {\n      params.append('ui_locales', options.locale)\n    }\n\n    if (options?.acr) {\n      params.append('claims', buildClaimsParameter(options.acr))\n    }\n\n    if (options?.acrValues) {\n      params.append('acr_values', options.acrValues)\n    }\n\n    if (this.pkceMethod) {\n      try {\n        const codeVerifier = generateCodeVerifier(96)\n        const pkceChallenge = await generatePkceChallenge(this.pkceMethod, codeVerifier)\n\n        callbackState.pkceCodeVerifier = codeVerifier\n\n        params.append('code_challenge', pkceChallenge)\n        params.append('code_challenge_method', this.pkceMethod)\n      } catch (error) {\n        throw new Error('Failed to generate PKCE challenge.', { cause: error })\n      }\n    }\n\n    this.#callbackStorage.add(callbackState)\n\n    return `${url}?${params.toString()}`\n  }\n\n  /**\n   * @param {KeycloakLogoutOptions} [options]\n   * @returns {Promise<void>}\n   */\n  logout = (options) => {\n    return this.#adapter.logout(options)\n  }\n\n  /**\n   * @param {KeycloakLogoutOptions} [options]\n   * @returns {string}\n   */\n  createLogoutUrl = (options) => {\n    const logoutMethod = options?.logoutMethod ?? this.logoutMethod\n    const url = this.endpoints.logout()\n\n    if (logoutMethod === 'POST') {\n      return url\n    }\n\n    const params = new URLSearchParams([\n      ['client_id', /** @type {string} */ (this.clientId)],\n      ['post_logout_redirect_uri', this.#adapter.redirectUri(options)]\n    ])\n\n    if (this.idToken) {\n      params.append('id_token_hint', this.idToken)\n    }\n\n    return `${url}?${params.toString()}`\n  }\n\n  /**\n   * @param {KeycloakRegisterOptions} [options]\n   * @returns {Promise<void>}\n   */\n  register = (options) => {\n    return this.#adapter.register(options)\n  }\n\n  /**\n   * @param {KeycloakRegisterOptions} [options]\n   * @returns {Promise<string>}\n   */\n  createRegisterUrl = (options) => {\n    return this.createLoginUrl({ ...options, action: 'register' })\n  }\n\n  /**\n   * @param {KeycloakAccountOptions} [options]\n   * @returns {string}\n   */\n  createAccountUrl = (options) => {\n    const url = this.#getRealmUrl()\n\n    if (!url) {\n      throw new Error('Unable to create account URL, make sure the adapter is not configured using a generic OIDC provider.')\n    }\n\n    const params = new URLSearchParams([\n      ['referrer', /** @type {string} */ (this.clientId)],\n      ['referrer_uri', this.#adapter.redirectUri(options)]\n    ])\n\n    return `${url}/account?${params.toString()}`\n  }\n\n  /**\n   * @returns {Promise<void>}\n   */\n  accountManagement = () => {\n    return this.#adapter.accountManagement()\n  }\n\n  /**\n   * @param {string} role\n   * @returns {boolean}\n   */\n  hasRealmRole = (role) => {\n    const access = this.realmAccess\n    return !!access && access.roles.indexOf(role) >= 0\n  }\n\n  /**\n   * @param {string} role\n   * @param {string} [resource]\n   * @returns {boolean}\n   */\n  hasResourceRole = (role, resource) => {\n    if (!this.resourceAccess) {\n      return false\n    }\n\n    const access = this.resourceAccess[resource || /** @type {string} */ (this.clientId)]\n    return !!access && access.roles.indexOf(role) >= 0\n  }\n\n  /**\n   * @returns {Promise<KeycloakProfile>}\n   */\n  loadUserProfile = async () => {\n    const realmUrl = this.#getRealmUrl()\n\n    if (!realmUrl) {\n      throw new Error('Unable to load user profile, make sure the adapter is not configured using a generic OIDC provider.')\n    }\n\n    const url = `${realmUrl}/account`\n    /** @type {KeycloakProfile} */\n    const profile = await fetchJSON(url, {\n      headers: [buildAuthorizationHeader(this.token)]\n    })\n\n    return (this.profile = profile)\n  }\n\n  /**\n   * @returns {Promise<{}>}\n   */\n  loadUserInfo = async () => {\n    const url = this.endpoints.userinfo()\n    /** @type {{}} */\n    const userInfo = await fetchJSON(url, {\n      headers: [buildAuthorizationHeader(this.token)]\n    })\n\n    return (this.userInfo = userInfo)\n  }\n\n  /**\n   * @param {number} [minValidity]\n   * @returns {boolean}\n   */\n  isTokenExpired = (minValidity) => {\n    if (!this.tokenParsed || (!this.refreshToken && this.flow !== 'implicit')) {\n      throw new Error('Not authenticated')\n    }\n\n    if (this.timeSkew == null) {\n      this.#logInfo('[KEYCLOAK] Unable to determine if token is expired as timeskew is not set')\n      return true\n    }\n\n    if (typeof this.tokenParsed.exp !== 'number') {\n      return false\n    }\n\n    let expiresIn = this.tokenParsed.exp - Math.ceil(new Date().getTime() / 1000) + this.timeSkew\n    if (minValidity) {\n      if (isNaN(minValidity)) {\n        throw new Error('Invalid minValidity')\n      }\n      expiresIn -= minValidity\n    }\n    return expiresIn < 0\n  }\n\n  /**\n   * @param {number} minValidity\n   * @returns {Promise<boolean>}\n   */\n  updateToken = async (minValidity) => {\n    if (!this.refreshToken) {\n      throw new Error('Unable to update token, no refresh token available.')\n    }\n\n    minValidity = minValidity || 5\n\n    if (this.#loginIframe.enable) {\n      await this.#checkLoginIframe()\n    }\n\n    let refreshToken = false\n\n    if (minValidity === -1) {\n      refreshToken = true\n      this.#logInfo('[KEYCLOAK] Refreshing token: forced refresh')\n    } else if (!this.tokenParsed || this.isTokenExpired(minValidity)) {\n      refreshToken = true\n      this.#logInfo('[KEYCLOAK] Refreshing token: token expired')\n    }\n\n    if (!refreshToken) {\n      return false\n    }\n\n    /** @type {PromiseWithResolvers<boolean>} */\n    const { promise, resolve, reject } = Promise.withResolvers()\n\n    this.#refreshQueue.push({ resolve, reject })\n\n    if (this.#refreshQueue.length === 1) {\n      const url = this.endpoints.token()\n      let timeLocal = new Date().getTime()\n\n      try {\n        const response = await fetchRefreshToken(url, this.refreshToken, /** @type {string} */ (this.clientId))\n        this.#logInfo('[KEYCLOAK] Token refreshed')\n\n        timeLocal = (timeLocal + new Date().getTime()) / 2\n\n        this.#setToken(response.access_token, response.refresh_token, response.id_token, timeLocal)\n\n        this.onAuthRefreshSuccess?.()\n        for (let p = this.#refreshQueue.pop(); p != null; p = this.#refreshQueue.pop()) {\n          p.resolve(true)\n        }\n      } catch (error) {\n        this.#logWarn('[KEYCLOAK] Failed to refresh token')\n\n        if (error instanceof NetworkError && error.response.status === 400) {\n          this.clearToken()\n        }\n\n        this.onAuthRefreshError?.()\n        for (let p = this.#refreshQueue.pop(); p != null; p = this.#refreshQueue.pop()) {\n          p.reject(error)\n        }\n      }\n    }\n\n    return await promise\n  }\n\n  clearToken = () => {\n    if (this.token) {\n      this.#setToken()\n      this.onAuthLogout?.()\n      if (this.loginRequired) {\n        this.login()\n      }\n    }\n  }\n\n  /**\n   * @param {string} [token]\n   * @param {string} [refreshToken]\n   * @param {string} [idToken]\n   * @param {number} [timeLocal]\n   */\n  #setToken (token, refreshToken, idToken, timeLocal) {\n    if (this.tokenTimeoutHandle) {\n      clearTimeout(this.tokenTimeoutHandle)\n      this.tokenTimeoutHandle = undefined\n    }\n\n    if (refreshToken) {\n      this.refreshToken = refreshToken\n      this.refreshTokenParsed = decodeToken(refreshToken)\n    } else {\n      delete this.refreshToken\n      delete this.refreshTokenParsed\n    }\n\n    if (idToken) {\n      this.idToken = idToken\n      this.idTokenParsed = decodeToken(idToken)\n    } else {\n      delete this.idToken\n      delete this.idTokenParsed\n    }\n\n    if (token) {\n      this.token = token\n      this.tokenParsed = decodeToken(token)\n      this.sessionId = this.tokenParsed.sid\n      this.authenticated = true\n      this.subject = this.tokenParsed.sub\n      this.realmAccess = this.tokenParsed.realm_access\n      this.resourceAccess = this.tokenParsed.resource_access\n\n      if (timeLocal) {\n        this.timeSkew = Math.floor(timeLocal / 1000) - this.tokenParsed.iat\n      }\n\n      if (this.timeSkew !== null) {\n        this.#logInfo('[KEYCLOAK] Estimated time difference between browser and server is ' + this.timeSkew + ' seconds')\n\n        if (this.onTokenExpired) {\n          const expiresIn = (this.tokenParsed.exp - (new Date().getTime() / 1000) + this.timeSkew) * 1000\n          this.#logInfo('[KEYCLOAK] Token expires in ' + Math.round(expiresIn / 1000) + ' s')\n          if (expiresIn <= 0) {\n            this.onTokenExpired()\n          } else {\n            this.tokenTimeoutHandle = window.setTimeout(this.onTokenExpired, expiresIn)\n          }\n        }\n      }\n    } else {\n      delete this.token\n      delete this.tokenParsed\n      delete this.subject\n      delete this.realmAccess\n      delete this.resourceAccess\n\n      this.authenticated = false\n    }\n  }\n\n  /**\n   * @returns {string=}\n   */\n  #getRealmUrl () {\n    if (typeof this.authServerUrl === 'undefined') {\n      return\n    }\n\n    return `${stripTrailingSlash(this.authServerUrl)}/realms/${encodeURIComponent(/** @type {string} */ (this.realm))}`\n  }\n\n  /**\n   * @param {Function} fn\n   * @returns {(message: string) => void}\n   */\n  #createLogger (fn) {\n    return (message) => {\n      if (this.enableLogging) {\n        fn.call(console, message)\n      }\n    }\n  }\n}\n\n/**\n * @returns {string}\n */\nfunction createUUID () {\n  if (typeof crypto === 'undefined' || typeof crypto.randomUUID === 'undefined') {\n    throw new Error('Web Crypto API is not available.')\n  }\n\n  return crypto.randomUUID()\n}\n\n/**\n * @param {Acr} requestedAcr\n * @returns {string}\n */\nfunction buildClaimsParameter (requestedAcr) {\n  return JSON.stringify({\n    id_token: {\n      acr: requestedAcr\n    }\n  })\n}\n\n/**\n * @param {number} len\n * @returns {string}\n */\nfunction generateCodeVerifier (len) {\n  return generateRandomString(len, 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789')\n}\n\n/**\n * @param {string} pkceMethod\n * @param {string} codeVerifier\n * @returns {Promise<string>}\n */\nasync function generatePkceChallenge (pkceMethod, codeVerifier) {\n  if (pkceMethod !== 'S256') {\n    throw new TypeError(`Invalid value for 'pkceMethod', expected 'S256' but got '${pkceMethod}'.`)\n  }\n\n  // hash codeVerifier, then encode as url-safe base64 without padding\n  const hashBytes = new Uint8Array(await sha256Digest(codeVerifier))\n  const encodedHash = bytesToBase64(hashBytes)\n    .replace(/\\+/g, '-')\n    .replace(/\\//g, '_')\n    .replace(/=/g, '')\n\n  return encodedHash\n}\n\n/**\n * @param {number} len\n * @param {string} alphabet\n * @returns {string}\n */\nfunction generateRandomString (len, alphabet) {\n  const randomData = generateRandomData(len)\n  const chars = new Array(len)\n  for (let i = 0; i < len; i++) {\n    chars[i] = alphabet.charCodeAt(randomData[i] % alphabet.length)\n  }\n  return String.fromCharCode.apply(null, chars)\n}\n\n/**\n * @param {number} len\n * @returns {Uint8Array<ArrayBuffer>}\n */\nfunction generateRandomData (len) {\n  if (typeof crypto === 'undefined' || typeof crypto.getRandomValues === 'undefined') {\n    throw new Error('Web Crypto API is not available.')\n  }\n\n  return crypto.getRandomValues(new Uint8Array(len))\n}\n\n/**\n * Function to extend existing native Promise with timeout\n *\n * @template T\n * @param {Promise<T>} promise\n * @param {number} timeout\n * @param {string} errorMessage\n * @returns {Promise<T>}\n */\nfunction applyTimeoutToPromise (promise, timeout, errorMessage) {\n  /** @type {number} */\n  let timeoutHandle\n  const timeoutPromise = new Promise(function (resolve, reject) {\n    timeoutHandle = window.setTimeout(function () {\n      reject(new Error(errorMessage || 'Promise is not settled within timeout of ' + timeout + 'ms'))\n    }, timeout)\n  })\n\n  return Promise.race([promise, timeoutPromise]).finally(function () {\n    clearTimeout(timeoutHandle)\n  })\n}\n\n/**\n * @returns {CallbackStorage}\n */\nfunction createCallbackStorage () {\n  try {\n    return new LocalStorage()\n  } catch (err) {\n    return new CookieStorage()\n  }\n}\n\nconst STORAGE_KEY_PREFIX = 'kc-callback-'\n\n/**\n * @typedef {Object} CallbackState\n * @property {string} state\n * @property {string} nonce\n * @property {string} redirectUri\n * @property {KeycloakLoginOptions} [loginOptions]\n * @property {KeycloakLoginOptions['prompt']} [prompt]\n * @property {string} [pkceCodeVerifier]\n */\n\n/**\n * @typedef {Object} CallbackStorage\n * @property {(state?: string) => CallbackState | null} get\n * @property {(state: CallbackState) => void} add\n */\n\n/**\n * @implements {CallbackStorage}\n */\nclass LocalStorage {\n  constructor () {\n    globalThis.localStorage.setItem('kc-test', 'test')\n    globalThis.localStorage.removeItem('kc-test')\n  }\n\n  /**\n   * @param {string} [state]\n   * @returns {CallbackState | null}\n   */\n  get (state) {\n    if (!state) {\n      return null\n    }\n\n    this.#clearInvalidValues()\n\n    const key = STORAGE_KEY_PREFIX + state\n    const value = globalThis.localStorage.getItem(key)\n\n    if (value) {\n      globalThis.localStorage.removeItem(key)\n      return JSON.parse(value)\n    }\n\n    return null\n  };\n\n  /**\n   * @param {CallbackState} state\n   */\n  add (state) {\n    this.#clearInvalidValues()\n\n    const key = STORAGE_KEY_PREFIX + state.state\n    const value = JSON.stringify({\n      ...state,\n      // Set the expiry time to 1 hour from now.\n      expires: Date.now() + (60 * 60 * 1000)\n    })\n\n    try {\n      globalThis.localStorage.setItem(key, value)\n    } catch (error) {\n      // If the storage is full, clear all known values and try again.\n      this.#clearAllValues()\n      globalThis.localStorage.setItem(key, value)\n    }\n  };\n\n  /**\n   * Clears all values from local storage that are no longer valid.\n   */\n  #clearInvalidValues () {\n    const currentTime = Date.now()\n\n    for (const [key, value] of this.#getStoredEntries()) {\n      // Attempt to parse the expiry time from the value.\n      const expiry = this.#parseExpiry(value)\n\n      // Discard the value if it is malformed or expired.\n      if (expiry === null || expiry < currentTime) {\n        globalThis.localStorage.removeItem(key)\n      }\n    }\n  }\n\n  /**\n   * Clears all known values from local storage.\n   */\n  #clearAllValues () {\n    for (const [key] of this.#getStoredEntries()) {\n      globalThis.localStorage.removeItem(key)\n    }\n  }\n\n  /**\n   * Gets all entries stored in local storage that are known to be managed by this class.\n   * @returns {[string, string][]} An array of key-value pairs.\n   */\n  #getStoredEntries () {\n    return Object.entries(globalThis.localStorage).filter(([key]) => key.startsWith(STORAGE_KEY_PREFIX))\n  }\n\n  /**\n   * Parses the expiry time from a value stored in local storage.\n   * @param {string} value\n   * @returns {number | null} The expiry time in milliseconds, or `null` if the value is malformed.\n   */\n  #parseExpiry (value) {\n    let parsedValue\n\n    // Attempt to parse the value as JSON.\n    try {\n      parsedValue = JSON.parse(value)\n    } catch (error) {\n      return null\n    }\n\n    // Attempt to extract the 'expires' property.\n    if (isObject(parsedValue) && 'expires' in parsedValue && typeof parsedValue.expires === 'number') {\n      return parsedValue.expires\n    }\n\n    return null\n  }\n}\n\n/**\n * @implements {CallbackStorage}\n */\nclass CookieStorage {\n  /**\n   * @param {string} [state]\n   * @returns {CallbackState | null}\n   */\n  get (state) {\n    if (!state) {\n      return null\n    }\n\n    const value = this.#getCookie(STORAGE_KEY_PREFIX + state)\n    this.#setCookie(STORAGE_KEY_PREFIX + state, '', this.#cookieExpiration(-100))\n    if (value) {\n      return JSON.parse(value)\n    }\n\n    return null\n  }\n\n  /**\n   * @param {CallbackState} state\n   */\n  add (state) {\n    this.#setCookie(STORAGE_KEY_PREFIX + state.state, JSON.stringify(state), this.#cookieExpiration(60))\n  }\n\n  /**\n   * @param {string} key\n   * @returns\n   */\n  #getCookie (key) {\n    const name = key + '='\n    const ca = document.cookie.split(';')\n    for (let i = 0; i < ca.length; i++) {\n      let c = ca[i]\n      while (c.charAt(0) === ' ') {\n        c = c.substring(1)\n      }\n      if (c.indexOf(name) === 0) {\n        return c.substring(name.length, c.length)\n      }\n    }\n    return ''\n  }\n\n  /**\n   * @param {string} key\n   * @param {string} value\n   * @param {Date} expirationDate\n   */\n  #setCookie (key, value, expirationDate) {\n    const cookie = key + '=' + value + '; ' +\n            'expires=' + expirationDate.toUTCString() + '; '\n    document.cookie = cookie\n  }\n\n  /**\n   * @param {number} minutes\n   * @returns {Date}\n   */\n  #cookieExpiration (minutes) {\n    const exp = new Date()\n    exp.setTime(exp.getTime() + (minutes * 60 * 1000))\n    return exp\n  }\n}\n\n/**\n * @param {Uint8Array<ArrayBuffer>} bytes\n * @see https://developer.mozilla.org/en-US/docs/Glossary/Base64#the_unicode_problem\n */\nfunction bytesToBase64 (bytes) {\n  const binString = String.fromCodePoint(...bytes)\n  return btoa(binString)\n}\n\n/**\n * @param {string} message\n * @see https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/digest#basic_example\n */\nasync function sha256Digest (message) {\n  const encoder = new TextEncoder()\n  const data = encoder.encode(message)\n\n  if (typeof crypto === 'undefined' || typeof crypto.subtle === 'undefined') {\n    throw new Error('Web Crypto API is not available.')\n  }\n\n  return await crypto.subtle.digest('SHA-256', data)\n}\n\n/**\n * @param {string} token\n * @returns {KeycloakTokenParsed}\n */\nfunction decodeToken (token) {\n  const [, payload] = token.split('.')\n\n  if (typeof payload !== 'string') {\n    throw new Error('Unable to decode token, payload not found.')\n  }\n\n  let decoded\n\n  try {\n    decoded = base64UrlDecode(payload)\n  } catch (error) {\n    throw new Error('Unable to decode token, payload is not a valid Base64URL value.', { cause: error })\n  }\n\n  try {\n    return JSON.parse(decoded)\n  } catch (error) {\n    throw new Error('Unable to decode token, payload is not a valid JSON value.', { cause: error })\n  }\n}\n\n/**\n * @param {string} input\n */\nfunction base64UrlDecode (input) {\n  let output = input\n    .replaceAll('-', '+')\n    .replaceAll('_', '/')\n\n  switch (output.length % 4) {\n    case 0:\n      break\n    case 2:\n      output += '=='\n      break\n    case 3:\n      output += '='\n      break\n    default:\n      throw new Error('Input is not of the correct length.')\n  }\n\n  try {\n    return b64DecodeUnicode(output)\n  } catch (error) {\n    return atob(output)\n  }\n}\n\n/**\n * @param {string} input\n */\nfunction b64DecodeUnicode (input) {\n  return decodeURIComponent(atob(input).replace(/(.)/g, (m, p) => {\n    let code = p.charCodeAt(0).toString(16).toUpperCase()\n\n    if (code.length < 2) {\n      code = '0' + code\n    }\n\n    return '%' + code\n  }))\n}\n\n/**\n * Check if the input is an object that can be operated on.\n * @param {unknown} input\n */\nfunction isObject (input) {\n  return typeof input === 'object' && input !== null\n}\n\n/**\n * @typedef {Object} JsonConfig The JSON version of the adapter configuration.\n * @property {string} auth-server-url The URL of the authentication server.\n * @property {string} realm The name of the realm.\n * @property {string} resource The name of the resource, usually the client ID.\n */\n\n/**\n * Fetch the adapter configuration from the given URL.\n * @param {string} url\n * @returns {Promise<JsonConfig>}\n */\nasync function fetchJsonConfig (url) {\n  return await fetchJSON(url)\n}\n\n/**\n * Fetch the OpenID configuration from the given URL.\n * @param {string} url\n * @returns {Promise<OpenIdProviderMetadata>}\n */\nasync function fetchOpenIdConfig (url) {\n  return await fetchJSON(url)\n}\n\n/**\n * @typedef {Object} AccessTokenResponse The successful token response from the authorization server, based on the {@link https://datatracker.ietf.org/doc/html/rfc6749#section-5.1 OAuth 2.0 Authorization Framework specification}.\n * @property {string} access_token The access token issued by the authorization server.\n * @property {string} token_type The type of the token issued by the authorization server.\n * @property {number} [expires_in] The lifetime in seconds of the access token.\n * @property {string} [refresh_token] The refresh token issued by the authorization server.\n * @property {string} [id_token] The ID token issued by the authorization server, if requested.\n * @property {string} [scope] The scope of the access token.\n */\n\n/**\n * Fetch the access token from the given URL.\n * @param {string} url\n * @param {string} code\n * @param {string} clientId\n * @param {string} redirectUri\n * @param {string} [pkceCodeVerifier]\n * @returns {Promise<AccessTokenResponse>}\n */\nasync function fetchAccessToken (url, code, clientId, redirectUri, pkceCodeVerifier) {\n  const body = new URLSearchParams([\n    ['code', code],\n    ['grant_type', 'authorization_code'],\n    ['client_id', clientId],\n    ['redirect_uri', redirectUri]\n  ])\n\n  if (pkceCodeVerifier) {\n    body.append('code_verifier', pkceCodeVerifier)\n  }\n\n  return await fetchJSON(url, {\n    method: 'POST',\n    credentials: 'include',\n    body\n  })\n}\n\n/**\n * Fetch the refresh token from the given URL.\n * @param {string} url\n * @param {string} refreshToken\n * @param {string} clientId\n * @returns {Promise<AccessTokenResponse>}\n */\nasync function fetchRefreshToken (url, refreshToken, clientId) {\n  const body = new URLSearchParams([\n    ['grant_type', 'refresh_token'],\n    ['refresh_token', refreshToken],\n    ['client_id', clientId]\n  ])\n\n  return await fetchJSON(url, {\n    method: 'POST',\n    credentials: 'include',\n    body\n  })\n}\n\n/**\n * @template [T=unknown]\n * @param {string} url\n * @param {RequestInit} init\n * @returns {Promise<T>}\n */\nasync function fetchJSON (url, init = {}) {\n  const headers = new Headers(init.headers)\n  headers.set('Accept', CONTENT_TYPE_JSON)\n\n  const response = await fetchWithErrorHandling(url, {\n    ...init,\n    headers\n  })\n\n  return await response.json()\n}\n\n/**\n * @param {string} url\n * @param {RequestInit} [init]\n * @returns {Promise<Response>}\n */\nasync function fetchWithErrorHandling (url, init) {\n  const response = await fetch(url, init)\n\n  if (!response.ok) {\n    throw new NetworkError('Server responded with an invalid status.', { response })\n  }\n\n  return response\n}\n\n/**\n * @param {string} [token]\n * @returns {[string, string]}\n */\nfunction buildAuthorizationHeader (token) {\n  if (!token) {\n    throw new Error('Unable to build authorization header, token is not set, make sure the user is authenticated.')\n  }\n\n  return ['Authorization', `bearer ${token}`]\n}\n\n/**\n * @param {string} url\n * @returns {string}\n */\nfunction stripTrailingSlash (url) {\n  return url.endsWith('/') ? url.slice(0, -1) : url\n}\n\n/**\n * @typedef {Object} NetworkErrorOptionsProperties\n * @property {Response} response\n * @typedef {ErrorOptions & NetworkErrorOptionsProperties} NetworkErrorOptions\n */\n\nexport class NetworkError extends Error {\n  /** @type {Response} */\n  response\n\n  /**\n   * @param {string} message\n   * @param {NetworkErrorOptions} options\n   */\n  constructor (message, options) {\n    super(message, options)\n    this.response = options.response\n  }\n}\n\n/**\n * @param {number} delay\n * @returns {Promise<void>}\n */\nconst waitForTimeout = (delay) => new Promise((resolve) => setTimeout(resolve, delay))\n"],"x_google_ignoreList":[0],"mappings":"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"}